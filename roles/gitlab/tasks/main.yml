# install gitlab
- debug:
    msg: Gitlab - {{ gitlab_distribution }} will be installed

- include: "{{ansible_os_family}}.yml"

- name: Creates gitlab dock directory
  file:
    path: "{{item}}"
    state: directory
    recurse: yes
  loop:
    - /data/wwwroot/gitlab
    - /data/wwwroot/gitlab/config
    - /data/wwwroot/gitlab/logs
    - /data/wwwroot/gitlab/data
  
- name: Copy docker-compose
  template:
    src:  docker-compose.yml
    dest: /data/wwwroot/gitlab/docker-compose.yml

- name: Run docker-compose
  shell: |
    docker-compose up -d 
    sleep 30s
  args:
    chdir: /data/wwwroot/gitlab
